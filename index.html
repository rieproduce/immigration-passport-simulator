<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Immigration Simulator: v5.21 Global Scan</title>
    <style>
        body { background-color: #050505; font-family: 'Courier New', Courier, monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; color: #d4af37; touch-action: none; }
        h1 { margin-bottom: 5px; font-size: 16px; letter-spacing: 4px; text-transform: uppercase; color: #ff3b30; text-align: center; }
        .info-panel { width: 90vw; max-width: 340px; display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 11px; border-bottom: 1px solid #222; padding-bottom: 5px; color: #666; }
        #timer { color: #ffcc00; font-weight: bold; }
        #game-container { width: 90vw; height: 90vw; max-width: 340px; max-height: 340px; background-color: #0f0f0f; border-radius: 2px; padding: 8px; position: relative; border: 1px solid #1a1a1a; box-shadow: 0 0 50px rgba(0,0,0,1); }
        
        #disclaimer-overlay, #roulette-overlay, #victory-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 20; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; color: #eee; overflow: hidden; }
        .warning-box { border: 1px solid #ff3b30; padding: 10px; margin-bottom: 15px; background: rgba(255,59,48,0.1); }
        .section-title { font-size: 10px; color: #ff3b30; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; }
        .rule-item { font-size: 9px; line-height: 1.5; color: #aaa; margin-bottom: 15px; }
        .disclaimer-btn, #spin-btn, .restart-btn { width: 100%; padding: 12px; font-size: 12px; background: #ff3b30; border: none; color: #fff; cursor: pointer; text-transform: uppercase; font-weight: bold; margin-top: auto; }
        
        #roulette-overlay { display: none; align-items: center; justify-content: center; text-align: center; z-index: 10; }
        #roulette-status { font-size: 14px; font-weight: bold; margin: 25px 0; color: #ff3b30; }

        /* --- ÂçáÁ¥öÂæåÁöÑÂãùÂà©Áï´Èù¢ --- */
        #victory-overlay { display: none; align-items: center; justify-content: flex-start; background: #000; z-index: 30; }
        .victory-header { width: 100%; border-bottom: 1px solid #d4af37; padding-bottom: 5px; margin-bottom: 10px; opacity: 0; transition: 1s; }
        .victory-title { color: #d4af37; font-size: 14px; letter-spacing: 2px; text-transform: uppercase; margin: 0; }
        
        .visual-area { width: 100%; height: 140px; position: relative; display: flex; gap: 10px; }
        /* Â∑¶ÂÅ¥Êó•Ë™å */
        #auth-log { width: 35%; height: 100%; font-size: 6px; color: #00ff00; overflow: hidden; display: flex; flex-direction: column-reverse; opacity: 0; transition: 1s; border-right: 1px solid #222; }
        /* Âè≥ÂÅ¥ÈªûÈô£Âú∞Âúñ */
        .map-canvas { width: 65%; height: 100%; background: #050505; display: grid; grid-template-columns: repeat(25, 1fr); grid-template-rows: repeat(15, 1fr); gap: 2px; padding: 5px; box-sizing: border-box; }
        .dot { background: #111; border-radius: 50%; transition: background 0.3s, box-shadow 0.3s; }
        .dot.active { background: #d4af37; box-shadow: 0 0 5px #d4af37; }

        .passport-data { color: #d4af37; font-size: 8px; text-align: left; margin: 15px 0; line-height: 1.4; opacity: 0; transition: 1.5s; width: 100%; background: rgba(212,175,55,0.05); padding: 5px; border-left: 2px solid #d4af37; }
        .victory-sub { color: #666; font-size: 9px; text-align: left; font-style: italic; opacity: 0; transition: 1s; width: 100%; }
        .restart-btn { background: transparent; border: 1px solid #d4af37; color: #d4af37; opacity: 0; transition: 1s; }
        .victory-active .victory-header, .victory-active #auth-log, .victory-active .passport-data, .victory-active .victory-sub, .victory-active .restart-btn { opacity: 1; }

        /* Ê£ãÁõ§ */
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-gap: 6px; width: 100%; height: 100%; }
        .cell { background-color: #111; border-radius: 1px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 8px; text-align: center; color: #d4af37; border: 1px solid rgba(255,255,255,0.02); }
        .tile-2 { background-color: #0d0d0d; } .tile-4 { background-color: #1a1a1a; } .tile-8 { background-color: #032b18; } .tile-16 { background-color: #08243f; } 
        .tile-32 { background-color: #4a130f; } .tile-64 { background-color: #5d2b0b; } .tile-128 { background-color: #1b2631; } .tile-256 { background-color: #053326; } 
        .tile-512 { background-color: #0c1a30; } .tile-1024 { background-color: #4b0d0d; } .tile-2048 { background-color: #9c7c38; color: #fff; border: 1px solid #fff; } 
        .cell-text { text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1px; font-size: 8px; }
        .cell-sub { font-size: 5px; opacity: 0.5; font-weight: normal; }
    </style>
</head>
<body>
    <h1>IMMIGRATION SIMULATOR</h1>
    <div class="info-panel">
        <div>HIGHEST: <span id="score" style="color:#d4af37">NONE</span></div>
        <div>VISA: <span id="timer">00s</span></div>
    </div>
    <div id="game-container">
        <div id="disclaimer-overlay">
            <div class="warning-box">
                <div class="section-title" style="margin-top:0;">‚ö†Ô∏è SYSTEM PROTOCOL</div>
                <div style="font-size: 9px; line-height: 1.4;">Accessing Global Hierarchy Database (v2025.12). Identity is a transient numeric value.</div>
            </div>
            <div class="section-title">üïπÔ∏è GUIDELINES</div>
            <div class="rule-item">SWIPE to merge. STATUS UPGRADE requires 2x resources. VISA is non-renewable.</div>
            <button class="disclaimer-btn" onclick="acceptDisclaimer()">INITIALIZE TERMINAL</button>
        </div>

        <div id="roulette-overlay">
            <h2 style="font-size:11px; letter-spacing:2px; color:#444;">BIRTHRIGHT PROTOCOL</h2>
            <div id="roulette-status">PENDING ALLOCATION</div>
            <button id="spin-btn" onclick="startRoulette()">Execute Fate</button>
        </div>

        <div id="victory-overlay">
            <div class="victory-header"><h1 class="victory-title">ACCESS GRANTED: WORLD ELITE</h1></div>
            <div class="visual-area">
                <div id="auth-log"></div>
                <div id="map-canvas" class="map-canvas"></div>
            </div>
            <div class="passport-data">
                <b>PASSPORT POWER: UAE (2048)</b><br>
                LEVEL: GOLDEN VISA / 182 COUNTRIES AUTHORIZED<br>
                ZONES: EU-SCHENGEN, UK-COMMONWEALTH, JAPAN, CHINA
            </div>
            <p class="victory-sub">"Borders are an obsolete concept for your class."</p>
            <button class="restart-btn" onclick="location.reload()">RE-INITIATE LIFE</button>
        </div>
        <div class="grid" id="grid"></div>
    </div>
<script>
const passportPools = { 2: ["Afghanistan", "Syria", "Iraq", "Yemen"], 4: ["Pakistan", "North Korea", "Libya"], 8: ["India", "Nigeria", "Vietnam"], 16: ["Philippines", "Indonesia", "Uzbekistan"], 32: ["China", "Thailand", "Belarus"], 64: ["Turkey", "Russia", "South Africa"], 128: ["HK (SAR)", "Brazil", "Argentina"], 256: ["Taiwan", "Israel", "Mexico"], 512: ["UK", "Canada", "Australia", "USA"], 1024: ["Germany", "Singapore", "Japan", "France"], 2048: ["UAE (Golden)"] };
const unlockList = ["UK", "Japan", "Germany", "France", "Canada", "Switzerland", "Singapore", "Australia", "New Zealand", "China", "Hong Kong", "Italy", "Spain", "Netherlands", "Belgium", "Sweden", "Norway", "Finland", "Iceland", "South Korea"];
let board = Array(16).fill(0).map(() => ({ val: 0, name: "" }));
let gameStarted = false, isPrivileged = false, timeLeft = 60, timerInterval, touchStartX = 0, touchStartY = 0;

// ÂàùÂßãÂåñÈªûÈô£Âú∞Âúñ
function initDots() {
    const canvas = document.getElementById('map-canvas');
    for (let i = 0; i < 375; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot';
        canvas.appendChild(dot);
    }
}
initDots();

function acceptDisclaimer() { document.getElementById('disclaimer-overlay').style.display = 'none'; document.getElementById('roulette-overlay').style.display = 'flex'; }
function getRandomCountry(val) { const pool = passportPools[val] || ["Stateless"]; return pool[Math.floor(Math.random() * pool.length)]; }

function startRoulette() {
    const statusDisplay = document.getElementById('roulette-status'); document.getElementById('spin-btn').disabled = true;
    let spinInterval = setInterval(() => { statusDisplay.innerText = getRandomCountry([2, 4, 8, 16, 32][Math.floor(Math.random() * 5)]).toUpperCase(); }, 80);
    setTimeout(() => { clearInterval(spinInterval); const rand = Math.random(); let finalVal = rand < 0.08 ? 2048 : (rand < 0.25 ? 128 : (rand < 0.55 ? 16 : 2)); isPrivileged = (finalVal === 2048);
        let finalName = getRandomCountry(finalVal); statusDisplay.innerText = "BORN IN: " + finalName.toUpperCase(); statusDisplay.style.color = finalVal >= 1024 ? "#d4af37" : "#00ff00";
        setTimeout(() => { document.getElementById('roulette-overlay').style.display = 'none'; initGame(finalVal, finalName); }, 1500);
    }, 2000);
}

function initGame(val, name) {
    board = board.map(() => ({ val: 0, name: "" })); gameStarted = true;
    if (isPrivileged) { board[5] = {val: 1024, name: getRandomCountry(1024)}; board[10] = {val: 1024, name: getRandomCountry(1024)}; timeLeft = 120; }
    else { board[Math.floor(Math.random() * 16)] = { val: val, name: name }; addRandomTile(); timeLeft = val >= 128 ? 90 : 60; }
    render(); startTimer();
}

function startTimer() { clearInterval(timerInterval); timerInterval = setInterval(() => { timeLeft--; document.getElementById('timer').innerText = timeLeft + "s"; if (timeLeft <= 0) endGame("DEPORTED."); }, 1000); }
function addRandomTile() { let empty = board.map((v, i) => v.val === 0 ? i : null).filter(v => v !== null); if (!empty.length) return; let target = empty[Math.floor(Math.random() * empty.length)]; let newVal = Math.random() < 0.9 ? 2 : 4; board[target] = { val: newVal, name: getRandomCountry(newVal) }; }

function render() {
    const grid = document.getElementById('grid'); grid.innerHTML = '';
    board.forEach(tile => { const c = document.createElement('div'); c.className = 'cell' + (tile.val ? ` tile-${tile.val}` : ''); if(tile.val) c.innerHTML = `<span class="cell-text">${tile.name}</span><span class="cell-sub">DOC:PS-${tile.val}</span>`; grid.appendChild(c); });
    const maxVal = Math.max(...board.map(t => t.val)); document.getElementById('score').innerText = (maxVal > 0 ? "TIER-" + maxVal : "NONE");
    if (maxVal === 2048) endGame(null, true);
}

function slide(row) {
    let arr = row.filter(t => t.val !== 0);
    for (let k = 0; k < arr.length - 1; k++) {
        if (arr[k].val === arr[k+1].val) {
            let newVal = arr[k].val * 2; arr[k] = { val: newVal, name: getRandomCountry(newVal) }; arr.splice(k+1, 1); timeLeft += 2;
            if (newVal === 256 || newVal === 512) { if (Math.random() < 0.12) { setTimeout(() => { alert("üõ°Ô∏è ELITE AMNESTY: Backlog cleared."); board = board.map(t => t.val === 2 ? {val:0, name:""} : t); render(); }, 500); }}
            if (!isPrivileged && newVal >= 64 && Math.random() < 0.08) { setTimeout(() => alert("‚ö†Ô∏è POLICY SHIFT: " + arr[k].name + " revoked."), 100); arr[k] = { val: 2, name: getRandomCountry(2) }; }
        }
    } while (arr.length < 4) arr.push({ val: 0, name: "" }); return arr;
}

function checkGameOver() { if (board.some(t => t.val === 0)) return false; for (let i = 0; i < 4; i++) { for (let j = 0; j < 4; j++) { let current = board[i * 4 + j].val; if (j < 3 && current === board[i * 4 + (j + 1)].val) return false; if (i < 3 && current === board[(i + 1) * 4 + j].val) return false; }} return true; }
function move(dir) { if (!gameStarted) return; let old = JSON.stringify(board); for (let i = 0; i < 4; i++) { let row = []; for (let j = 0; j < 4; j++) { if (dir === 'left') row.push(board[i * 4 + j]); else if (dir === 'right') row.push(board[i * 4 + (3 - j)]); else if (dir === 'up') row.push(board[j * 4 + i]); else if (dir === 'down') row.push(board[(3 - j) * 4 + i]); } let res = slide(row); for (let j = 0; j < 4; j++) { if (dir === 'left') board[i * 4 + j] = res[j]; else if (dir === 'right') board[i * 4 + (3 - j)] = res[j]; else if (dir === 'up') board[j * 4 + i] = res[j]; else if (dir === 'down') board[(3 - j) * 4 + i] = res[j]; }} if (old !== JSON.stringify(board)) { addRandomTile(); render(); if (checkGameOver()) setTimeout(() => endGame("GRIDLOCK."), 300); }}

function endGame(msg, isVictory = false) {
    gameStarted = false; clearInterval(timerInterval);
    if (isVictory) {
        const overlay = document.getElementById('victory-overlay'); overlay.style.display = 'flex';
        setTimeout(() => { overlay.classList.add('victory-active'); playVictoryRitual(); }, 100);
    } else { alert(msg); location.reload(); }
}

// --- Ê†∏ÂøÉÔºöÈªûÈô£ÊéÉÊèèËàáÊó•Ë™åÂãïÁï´ ---
function playVictoryRitual() {
    const dots = document.querySelectorAll('.dot');
    const log = document.getElementById('auth-log');
    let dotIdx = 0;

    const ritual = setInterval(() => {
        if (dotIdx >= dots.length) { clearInterval(ritual); return; }
        
        // Èö®Ê©üÈªû‰∫ÆÂ§öÂÄãÈªû‰ª•Â¢ûÂä†ÈÄüÂ∫¶
        for(let i=0; i<8; i++) {
            let randDot = dots[Math.floor(Math.random() * dots.length)];
            randDot.classList.add('active');
        }

        // ÂêåÊ≠•Â¢ûÂä†ÊéàÊ¨äÊó•Ë™å
        if (dotIdx % 10 === 0) {
            const country = unlockList[Math.floor(Math.random() * unlockList.length)];
            const logEntry = document.createElement('div');
            logEntry.innerText = `> AUTH: ${country} ... OK`;
            log.prepend(logEntry);
        }
        
        dotIdx += 5;
    }, 50);
}

window.addEventListener('keydown', e => { if (e.key.includes('Arrow')) move(e.key.replace('Arrow', '').toLowerCase()); });
window.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; touchStartY = e.changedTouches[0].screenY; });
window.addEventListener('touchend', e => { let dx = e.changedTouches[0].screenX - touchStartX; let dy = e.changedTouches[0].screenY - touchStartY; if (Math.abs(dx) > Math.abs(dy)) { if (Math.abs(dx) > 30) move(dx > 0 ? 'right' : 'left'); } else { if (Math.abs(dy) > 30) move(dy > 0 ? 'down' : 'up'); } });
</script>
</body>
</html>
